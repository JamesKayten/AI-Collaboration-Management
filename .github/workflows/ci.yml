name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  shellcheck:
    name: Shell Script Validation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: '.'
          severity: warning

  markdown-lint:
    name: Markdown Linting
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Markdown Lint
        uses: nosborn/github-action-markdown-cli@v3.3.0
        with:
          files: .
          config_file: .markdownlint.json
          ignore_files: node_modules/

  test-installation:
    name: Test Installation
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Create test project
        run: |
          mkdir -p test-project
          cd test-project
          git init
          git config user.email "test@example.com"
          git config user.name "Test User"
          echo "# Test Project" > README.md
          git add README.md
          git commit -m "Initial commit"

      - name: Run installer
        run: |
          cd test-project
          bash ../setup-ai-collaboration.sh

      - name: Verify installation
        run: |
          cd test-project
          # Check that required directories exist
          test -d .ai-framework || exit 1
          test -d .ai-framework/communications || exit 1
          test -d .ai-framework/project-state || exit 1
          test -d .ai-framework/rules || exit 1

          # Check that required files exist
          test -f .ai-framework/rules/VALIDATION_RULES.md || exit 1
          test -f .ai-framework/project-state/PROJECT_STATE.md || exit 1

          echo "âœ… Installation verification passed"

  link-checker:
    name: Check Links
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Check links in markdown files
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          use-quiet-mode: 'yes'
          config-file: '.github/markdown-link-check.json'
