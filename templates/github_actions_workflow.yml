# AI Collaboration Framework - GitHub Actions Integration
# Place this file at: .github/workflows/ai-collaboration.yml

name: AI Collaboration Framework Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  ai-validation:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Setup Node.js (for JavaScript projects)
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
      if: contains(github.repository, 'javascript') || contains(github.repository, 'typescript') || contains(github.repository, 'react')

    - name: Setup Python (for Python projects)
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
      if: contains(github.repository, 'python') || contains(github.repository, 'django') || contains(github.repository, 'flask')

    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install black flake8 pytest pytest-cov bandit safety
      if: contains(github.repository, 'python') || contains(github.repository, 'django') || contains(github.repository, 'flask')

    - name: Install JavaScript dependencies
      run: npm install
      if: contains(github.repository, 'javascript') || contains(github.repository, 'typescript') || contains(github.repository, 'react')

    # AI Collaboration Framework Validation
    - name: Run AI Framework Validation
      run: |
        echo "ðŸ¤– Running AI Collaboration Framework Validation..."

        # Check for framework files
        if [ ! -f "docs/AI_WORKFLOW.md" ]; then
          echo "âŒ AI Workflow documentation missing"
          exit 1
        fi

        if [ ! -d "docs/ai_communication" ]; then
          echo "âŒ AI Communication directory missing"
          exit 1
        fi

        echo "âœ… AI Framework files found"

    - name: Python Code Quality (if Python project)
      run: |
        echo "ðŸ Running Python validation..."

        # Black formatting check
        black --check . || {
          echo "âŒ Black formatting violations found"
          echo "ðŸ’¡ Run: black . to fix"
          exit 1
        }

        # Flake8 style check
        flake8 . --max-line-length=88 --extend-ignore=E203 || {
          echo "âŒ Flake8 style violations found"
          exit 1
        }

        # Security check
        bandit -r . -f json -o bandit-report.json || {
          echo "ðŸš¨ Security vulnerabilities detected"
          cat bandit-report.json
          exit 1
        }

        echo "âœ… Python validation passed"

      if: contains(github.repository, 'python') || contains(github.repository, 'django') || contains(github.repository, 'flask')

    - name: JavaScript/TypeScript Code Quality (if JS/TS project)
      run: |
        echo "ðŸ“¦ Running JavaScript/TypeScript validation..."

        # ESLint check
        npx eslint src/ --ext .js,.jsx,.ts,.tsx --max-warnings 0 || {
          echo "âŒ ESLint violations found"
          echo "ðŸ’¡ Run: npx eslint src/ --fix"
          exit 1
        }

        # Prettier check
        npx prettier --check "src/**/*.{js,jsx,ts,tsx,json,css,md}" || {
          echo "âŒ Prettier formatting violations found"
          echo "ðŸ’¡ Run: npx prettier --write \"src/**/*.{js,jsx,ts,tsx,json,css,md}\""
          exit 1
        }

        # TypeScript check (if tsconfig exists)
        if [ -f "tsconfig.json" ]; then
          npx tsc --noEmit --strict || {
            echo "âŒ TypeScript compilation errors found"
            exit 1
          }
        fi

        echo "âœ… JavaScript/TypeScript validation passed"

      if: contains(github.repository, 'javascript') || contains(github.repository, 'typescript') || contains(github.repository, 'react')

    - name: Run Tests with Coverage
      run: |
        echo "ðŸ§ª Running test suite..."

        # Python tests
        if command -v pytest &> /dev/null; then
          pytest --cov=. --cov-report=json --cov-fail-under=85 || {
            echo "âŒ Test coverage below 85%"
            exit 1
          }
        fi

        # JavaScript tests
        if [ -f "package.json" ] && grep -q "test" package.json; then
          npm test -- --coverage --watchAll=false || {
            echo "âŒ Tests failed or coverage insufficient"
            exit 1
          }
        fi

        echo "âœ… Tests passed with adequate coverage"

    - name: Generate AI Validation Report
      run: |
        echo "ðŸ“Š Generating AI validation report..."

        REPORT_FILE="docs/ai_communication/AI_REPORT_$(date +%Y-%m-%d)_CI_VALIDATION.md"

        cat > "$REPORT_FILE" << 'EOF'
        # ðŸ¤– AI Collaboration Framework - CI Validation Report

        **Date:** $(date)
        **Build:** ${{ github.run_number }}
        **Commit:** ${{ github.sha }}
        **Branch:** ${{ github.ref_name }}

        ## âœ… Validation Results

        - **Code Quality**: âœ… PASSED
        - **Security Scan**: âœ… PASSED
        - **Test Coverage**: âœ… PASSED (â‰¥85%)
        - **Framework Files**: âœ… PRESENT

        ## ðŸŽ¯ Ready for AI Collaboration

        This codebase is ready for cross-platform AI collaboration workflow.

        **Framework:** Avery's AI Collaboration Hack v2.0
        **CI Integration:** GitHub Actions
        EOF

        echo "âœ… AI validation report generated: $REPORT_FILE"

    - name: Commit AI Report (if changes detected)
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "AI Framework CI"

        if git diff --quiet; then
          echo "No changes to commit"
        else
          git add docs/ai_communication/
          git commit -m "ðŸ¤– AI Framework CI Validation Report

          Generated automated validation report for cross-platform AI collaboration.

          ðŸ§ª Generated with GitHub Actions
          Framework: Avery's AI Collaboration Hack v2.0"

          git push origin ${{ github.ref_name }}
          echo "âœ… AI validation report committed"
        fi
      if: github.event_name == 'push'

    - name: Framework Status Summary
      run: |
        echo "ðŸŽ‰ AI Collaboration Framework Validation Complete!"
        echo ""
        echo "âœ… Code quality validation passed"
        echo "âœ… Security scan completed"
        echo "âœ… Test coverage verified"
        echo "âœ… Framework files validated"
        echo "âœ… Ready for AI collaboration workflow"
        echo ""
        echo "ðŸ¤– Framework: Avery's AI Collaboration Hack v2.0"
        echo "ðŸ”— Repository: ${{ github.repository }}"